# Discord Bot
Многофункциональный Discord бот с возможностями музыкального плеера, системой автоматической выдачи ролей и потоковым воспроизведением радиостанций.
## Основные возможности
### Музыкальный плеер
- `/play [URL/название]` - воспроизведение музыки с YouTube, Twitch, Bandcamp
- Автоматическое подключение к вашему голосовому каналу
- Управление воспроизведением через кнопки
- Отображение прогресса воспроизведения

### Радио
- `/radio name:[название]` - воспроизведение радиостанции 
- `/radio_list` - просмотр всех доступных радиостанций
- `/radio_add name:[название] url:[URL]` - добавление новой радиостанции (только для администраторов)
- `/radio_remove name:[название]` - удаление радиостанции из списка (только для администраторов)
- `/radio_reload` - обновление списка радиостанций до стандартного набора (только для администраторов)
- Автоматическое подключение к голосовому каналу
- Визуальное отображение списка радиостанций через эмбеды

### Система ролей
- `!role [channel_id] [role_id] [emoji_id]` - добавление правила автовыдачи роли
- `!del_role [index]` - удаление правила по индексу
- `!del_role all` - удаление всех правил
- Автоматическая выдача ролей при реакции на сообщение
### Общие команды
- `/ping` - проверка работоспособности бота
- `/rules` - отображение правил сервера
- `/info` - информация о сервере
- `/hello` - приветственное сообщение
- `/invite` - получение ссылки-приглашения
### Команды конфигурации

Бот поддерживает следующие команды для настройки:

- `!read_conf` - отображение текущей конфигурации
- `!id [id_owner]` - установка ID владельца бота
- `!id_del` - удаление ID владельца
- `!role [id_channel id_role id_emoji]` - добавление правила автоматической выдачи роли
- `!link [url]` - установка ссылки-приглашения на сервер
- `!del_role [number]` - удаление правила автоматической выдачи роли
### Команды конфигурации мониторинга
- `!monitor channel <id>` - установка канала для мониторинга
- `!monitor add <ip:port> <тип>` - добавление сервера
- `!monitor remove <n>` - удаление сервера
- `!monitor list` - список серверов
- `!monitor start` - запуск мониторинга
- `!monitor stop` - остановка мониторинга
### Мониторинг серверов
- Поддержка Source протокола (CS:GO, Rust, TF2 и др.)
- Отображение статуса серверов
- Количество игроков
- Текущая карта
- Автоматическое обновление информации
## Установка и настройка
### Системные требования
- Java 11 или выше
- Maven для сборки проекта
- Discord Bot Token
### Сборка проекта
```bash
mvn clean package
```
Собранный JAR-файл будет находиться в директории `target/DiscordjBot-1.0-jar-with-dependencies.jar`
### Конфигурация

Для работы бота необходимы следующие настройки:

- Discord Bot Token (передается как аргумент командной строки или через переменную окружения)

Все настройки сервера (роли, правила, радиостанции и другие параметры) хранятся в отдельных файлах для каждой гильдии в директории `config/`. Имя файла формируется на основе имени сервера.

Пример структуры конфигурации для сервера:
```json
{
  "owner": "your-owner-id",
  "inviteLink": "your-discord-invite-link",
  "roles": [],
  "radioStations": [],
  "rules": {
    "title": "Правила сервера",
    "welcomeField": "Добро пожаловать!",
    "rulesField": "1. Правило 1\n2. Правило 2",
    "footer": "Обновлено {date} пользователем {author}"
  }
}
```
### Запуск

Существует два способа указания токена:

1. Аргумент командной строки
2. Переменная окружения `TOKEN`

### Через JAR-файл

```bash
java -jar DiscordjBot-1.0-jar-with-dependencies.jar [token]
```

### Через скрипты запуска

#### Windows

```bash
run.bat [token]
```

#### Linux/Mac

```bash
chmod +x run.sh
./run.sh [token]
```

### Через Docker

```bash
docker-compose up -d
```

При использовании Docker необходимо создать файл `.env` с переменной:
```
DISCORD_TOKEN=your-discord-bot-token-here
```
## Настройка автовыдачи ролей
1. Создайте роль на сервере Discord
2. Получите необходимые ID:
   - ID канала (ПКМ по каналу → Копировать ID)
   - ID роли (Настройки сервера → Роли → Копировать ID)
   - ID эмодзи (Поставьте эмодзи и скопируйте его)
3. Добавьте правило командой:
   ```
   !role channel_id role_id emoji_id
   ```

## Настройка радиостанций
Бот поддерживает динамическую конфигурацию радиостанций без необходимости перезапуска:

1. **Просмотр доступных радиостанций**:
   - Используйте команду `/radio_list` для просмотра всех доступных радиостанций

2. **Добавление новой радиостанции**:
   - Используйте команду `/radio_add` с параметрами:
     - `name` - название радиостанции
     - `url` - URL потока (начинается с http:// или https://)
   - Требуются права администратора сервера

3. **Удаление радиостанции**:
   - Используйте команду `/radio_remove` с параметром `name` - название радиостанции для удаления
   - Требуются права администратора сервера

4. **Воспроизведение радиостанции**:
   - Используйте команду `/radio name:название` - бот автоматически подключится к голосовому каналу

5. **Обновление списка радиостанций**:
   - Используйте команду `/radio_reload` для обновления списка до стандартного набора станций
   - Требуются права администратора сервера

6. **Особенности**:
   - Каждый сервер имеет свой собственный список радиостанций
   - При создании конфигурации добавляются стандартные радиостанции
   - Все изменения сохраняются в конфигурации сервера
   - В стандартный набор входят популярные станции Radio Record, Зайцев.FM и другие

## Используемые технологии
### Основные библиотеки
- JDA (Java Discord API) 5.2.1 - основной фреймворк для работы с Discord
- LavaPlayer 2.2.2 - библиотека для воспроизведения аудио
- Jackson 2.13.4.2 - работа с JSON
- SLF4J и Logback - логирование
### Функциональные возможности
- Воспроизведение музыки с YouTube
- Потоковое воспроизведение радиостанций
- Система автоматической выдачи ролей
- Конфигурация через JSON
- Управление через slash-команды и текстовые команды
- Мониторинг серверов
- Поддержка Source протокола (CS:GO, Rust, TF2 и др.)
- Автоматическое обновление информации
### Особенности реализации
- Паттерн Singleton для работы с конфигурацией
- Потокобезопасная обработка конфигурации
- Автоматическое создание и обновление конфигурации
- Форматированный вывод через Embed сообщения
## Разработка
### Структура проекта
```
src/
├── main/
│   ├── java/ru/discordj/bot/
│   │   ├── config/
│   │   ├── events/
│   │   │   └── slashcommands/
│   │   │   └── listener/
│   │   │        └── configurator/
│   │   │             └── command/
│   │   ├── lavaplayer/
│   │   ├── monitor/
│   │   │   └── parser/
│   │   │   └── sender/
│   │   │   └── tools/
│   │   │   └── query/
│   │   └── utility/
│   │        └── pojo/
│   └── resources/
│         └── META-INF/
```
### Сборка проекта
Проект использует Maven для управления зависимостями и сборки:
- Автоматическое включение зависимостей
- Копирование ресурсов
- Создание исполняемого JAR-файла
## Примечания
- Конфигурационные файлы для каждого сервера создаются автоматически при первом использовании бота на сервере
- Все настройки сервера (правила, роли, радиостанции) хранятся в одном файле конфигурации
- Для обновления списка радиостанций используйте команду `/radio_reload` (требуются права администратора)
- Все сообщения об успешных действиях и ошибках являются эфемерными (видны только вызвавшему команду пользователю) и автоматически удаляются через 30 секунд
- Список радиостанций включает популярные станции Radio Record, Зайцев.FM, Европа Плюс и другие
- Все изменения конфигурации сохраняются автоматически
- Для запуска бота на Windows рекомендуется использовать скрипт `run.bat`, который решает проблемы с кодировкой и запускает бота в свернутом окне
- Для запуска бота на Linux/Mac используйте скрипт `run.sh` для корректного отображения русских символов в логах

